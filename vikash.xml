<?xml version="1.0" encoding="UTF-8"?>
<Module>
  <ModulePrefs title=" "
    description=""
	height="340"
    author="RajkUmar and VIkash"
    author_email="admin11@lodhagroup.in"
    author_location="Lodha Excelus,NM JOSHI MARG,Mumbai ....september252014444">

    <!-- Declare feature dependencies. -->

    <!-- This one is not specific to Gmail contextual gadgets. -->
    <Require feature="dynamic-height"/>
	<Require feature="opensocial-0.8" />
    <Require feature="oauthpopup" />
	
  
   
   
	 
	 <Require feature="google.contentmatch">
      <Param name="extractors">
        google.com:SenderEmailExtractor,google.com:SubjectExtractor,google.com:EmailBodyExtractor
      </Param>
    </Require>

  </ModulePrefs>
  <Content type="html" view="card">
    <![CDATA[
		<script src="https://apis.google.com/js/client.js?onload=checkAuth"></script>
		<script type='text/javascript' src='https://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js'></script>
		<script type='text/javascript' src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.4/jquery-ui.min.js"></script>
		<script type='text/javascript'>
		/***************************************************************************************************************/
		//Get the matched content from the email START
		/***************************************************************************************************************/
       // Fetch the array of content matches. 
        var matches = google.contentmatch.getContentMatches();
        var matchList = document.createElement('UL');
        var listItem;
        var extractedText;
		var email_id;
		var subject;
      var msg_id;
      var from_email;
      var cc_emails;
		var email_body;
		var allEmails ;
		var sep = "$$^";
		var MYcc_emails = "";
		var  mySenderEmails = "";
		
		alert("Before  new Gmail API Code:: "+ matches+"----"+matches.length)
		/*
		for (var key in matches[0]) {
		    alert(key + "- 0 -> " + matches[0][key]);
		}
		for (var key in matches[1]) {
		    alert(key + "- 1 -> " + matches[1][key]);
		}
		for (var key in matches[2]) {
		    alert(key + "- 2 -> " + matches[2][key]);
		}
		for (var key in matches[3]) {
		    alert(key + "- 3 -> " + matches[3][key]);
		}
		*/
		var i;
		for(i=0; i<matches.length; i++;){
			for (var key in matches[i]) {
			    alert(key + "- "+i+" -> " + matches[i][key]);
			}
		}
		//*************$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ New code for call GMAIL API $$$$$$$$$$$$$$$$$$$$$$$$$$***************//
		//*************$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$ New code for call GMAIL API $$$$$$$$$$$$$$$$$$$$$$$$$$***************//
        //<!-- Iterate through the array and display output for each match. -->
        for (var match in matches) {
			for (var key in matches[match]) {
				listItem = document.createElement('LI');
            			
              			//alert("Key-->"+key);
              			//alert("listItem-->"+listItem);
				 //extractedText1 = document.createTextNode(key + ": " + matches[match][key]);
				 ////if(key=="recipient_to_email")//sent mail DATA
				if( key =="sender_email")
				{
				inOutEmail =matches[match][key];
               			inOutEmail =  inOutEmail.replace(/\./g,'dot');
               			//inOutEmail =  inOutEmail.replace('.','dot');
               			//alert("inOutEmail-->"+inOutEmail);
				//==================================================================//
				email_id =matches[match][key];
               			email_id =  email_id.replace(/\./g,'dot');
               			email_id =  email_id.replace('.','dot');
               			//email_id = email_id.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);
               			//allEmails = email_id.concat(email_id);
               			//alert("sender_email-->email_id-->"+email_id);
               			//alert("RefErre-->"+document.referrer.split('#'));
				}
          			if(key == 'recipient_to_email')
                    		{
                   	
                    		from_email  =matches[match][key];
                    		from_email =  from_email.replace(/\./g,'dot');
               			from_email =  from_email.replace('.','dot');
               			mySenderEmails = mySenderEmails+from_email+";";
                     	//	from_email = from_email.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);
                     	//	alert(" recipient_to_email -->"+from_email);
                     		//allEmails = allEmails.concat(sep);
                     		alert("ALL EMAILS==>"+allEmails);
                     		getUserRole(from_email);
                    		}
                    		
            			if(key == 'recipient_cc_email')
                    		{
	                    	cc_emails  = matches[match][key];
	                        cc_emails = cc_emails.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);
	                        MYcc_emails = MYcc_emails+cc_emails+";";
	                        //MYcc_emails
	                        //alert("In recipient_cc_email-->"+MYcc_emails);
	                     //alert("after the expression from gadget rec_email111-->"+from_email);
	                     getUserRole(cc_emails);
	                    }
	                    //if(key == 'recipient_email')
                    	   //	{
                    	   //	recipient_email = matches[match][key];
                    	   //	recipient_email = recipient_email.match(/([a-zA-Z0-9._-]+@[a-zA-Z0-9._-]+\.[a-zA-Z0-9._-]+)/gi);
                    	   	alert("recipient_email-->"+recipient_email);
                    	   //	}
				if(key == "email_body")
				{
					email_body =matches[match][key]; 
				//	alert("email_body-->"+email_body);
				}
				if(key == "subject")
				{
					subject =matches[match][key];
					//alert("subject-->"+subject);
				}
            		if(key == 'message_id')
                    	{
                    	msg_id = matches[match][key];
                    	//alert("msg_id-->"+msg_id);
                	 }
            }
        }
		</script>
	  
	
			<div align="center"><h1>Hello World 444444</h1></div>
			 <!-- REMOVEFROMHERE PRASHANT-->
    ]]>
  </Content>
</Module>
